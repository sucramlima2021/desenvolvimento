{% load static %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Cliente: {{cliente.nome}}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .botao {
      background-color: lightblue;
      transition: background-color 0.2s ease;
      text-decoration: none;
      color: black;
    }

    .botao:hover {
      background-color: lightgreen;
    }
  </style>
</head>

<body>
  <div class="d-flex">
    <div class="col-2 bg-dark text-white d-flex flex-column p-2 mh-100" style="min-height: 100vh;">
      <div>
        <h5 class="mb-4">Menu</h5>
        <div class="d-grid gap-2">
          <a href="{% url 'clientes_update' cliente.pk %}" class="btn btn-outline-light">Cadastro</a>
          <a href="#" class="btn btn-light">Resumo</a>
          <a href="{% url 'agregados_list' cliente.pk %}" class="btn btn-outline-light">Agregados</a>
          <a href="{% url 'clientes_update' cliente.pk %}" class="btn btn-outline-light">Beneficiários</a>
          <a href="{% url 'escolhe_apolice' cliente.pk %}" class="btn btn-outline-light">Incluir Apólice</a>
          <a class="btn btn-outline-light">Emitir Certificado</a>
          <a href="{% url 'sinistros_create' cliente.pk %}" class="btn btn-outline-light">Incluir Sinistro</a>
          
          <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">Excluir Cliente</button>
          <a href="{% url 'clientes' %}" class="btn btn-outline-light my-5">Inicio</a>
        </div>
      </div>

    </div>

    <div class="col-10 px-2">
        <h2 class="text-center">Histórico do Cliente </h2>
      <h5 class="my-3">{{cliente.nome}}</h5>
<ul class="nav nav-tabs" id="historicoTabs" role="tablist">
  {% for nome, registros in historicos.items %}
    <li class="nav-item" role="presentation">
      <button class="nav-link {% if forloop.first %}active{% endif %}"
              id="tab-{{ forloop.counter }}"
              data-bs-toggle="tab"
              data-bs-target="#conteudo-{{ forloop.counter }}"
              type="button"
              role="tab">
        {{ nome }}
      </button>
    </li>
  {% endfor %}
</ul>

<div class="tab-content mt-3">
  {% for nome, registros in historicos.items %}
    <div class="tab-pane fade {% if forloop.first %}show active{% endif %}"
         id="conteudo-{{ forloop.counter }}"
         role="tabpanel">

      {% if registros %}
        <table class="table table-sm table-striped">
          <thead>
            <tr>
              <th style="width: 150px;">Data</th>
              <th>Usuário</th>
              </tr>
              <tr>
              <th colspan="2"></th>
            </tr>
          </thead>
          <tbody>
            {% for r in registros %}
              <tr>
                <td>{{ r.data|date:"d/m/Y H:i" }}</td>
                <td>{{ r.usuario }}</td>
                </tr><tr>
                  
                <td colspan="2">
                  {% if r.acao == "Criado" %}
        <span class="text-success"><b>Registro criado</b></span>
      {% elif r.acao == "Excluído" %}
        <span class="text-danger"><b>Registro excluído</b></span>
      {% else %}
                  <span>Alterações:</span>
                  {% if r.diff %}
                    <ul class="mb-0">
                      {% for field, values in r.diff.items %}
                        <li>
                          <b>{{ field }}:</b>
                          de <span class="text-danger">{{ values.old }}</span>
                          para <span class="text-success">{{ values.new }}</span>
                        </li>
                      {% endfor %}
                    </ul>
                  {% else %}
                    <i>Nenhuma alteração relevante</i>
                  {% endif %}
                  {%endif%}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <i>Nenhuma alteração registrada</i>
      {% endif %}
    </div>
  {% endfor %}
</div>

    </div>
    
  </div>
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="confirmDeleteLabel">Confirmação de Exclusão</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        Realmente deseja excluir este cliente?
      </div>
      <div class="modal-footer">
        <!-- Botão "Não" apenas fecha o modal -->
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
        <!-- Botão "Sim" redireciona -->
        <a href="{% url 'clientes_delete' cliente.pk %}" class="btn btn-danger">Sim</a>
      </div>
    </div>
  </div>
</div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>







