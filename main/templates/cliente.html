{% load static %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Cliente: {{cliente.nome}}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .botao {
      background-color: lightblue;
      transition: background-color 0.2s ease;
      text-decoration: none;
      color: black;
    }

    .botao:hover {
      background-color: lightgreen;
    }
  </style>
</head>

<body>
  <div class="d-flex">
    <div class="col-2 bg-dark text-white d-flex flex-column p-2 mh-100" style="min-height: 100vh;">
      <div>
        <h5 class="mb-4">Menu</h5>
        <div class="d-grid gap-2">
          <a href="#" class="btn btn-light">Resumo</a>
          <a href="{% url 'clientes_update' cliente.pk %}" class="btn btn-outline-light">Alterar Cadastro</a>
          <a class="btn btn-outline-light">Emitir Certificado</a>
          <a class="btn btn-outline-light">Incluir Sinistro</a>
          <a href="{% url 'escolhe_apolice' cliente.pk %}" class="btn btn-outline-light">Incluir Apólice</a>
          <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">Excluir Cliente</button>
          <a href="{% url 'clientes' %}" class="btn btn-outline-light my-5">Inicio</a>
        </div>
      </div>

    </div>

    <div class="col-10">
      
        <div class="d-flex mt-2 flex-column">
          <h4 class="me-3">Cliente: {{cliente.nome}}</h4>
          <h4 class="me-3">Matricula: {{cliente.matricula}}</h4>

        
        
      </div>
      {%if apolices %}
      <div class="d-flex flex-column mt-3 px-3 border">
        <span class="fs-5">Resumo das Coberturas CEPE VIDA:</span>
        
        <table class="table table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th rowspan="2">Apólice</th>
              <th colspan="2">Principal</th>
              <th colspan="2">Cônjuge</th>
              <th rowspan="2">Diagnóstico</th>
              <th rowspan="2">Aux. Baba</th>
            </tr>
            <tr>
              
              <th>Prêmio</th>
              <th>IS Básica</th>
              <th>Prêmio</th>
              <th>IS Básica</th>
            </tr>
          </thead>
          <tbody>
            {% for tipo, info in apolices.items %}
            {# só entra no loop interno se existir ao menos 1 apólice #}
            {% if info.tem %}
            {% for ap in info.apol %}
            <tr>
              {%if tipo == "DECESSO"%}
              <td><a href="{% url 'decesso_update' ap.pk %}">Decesso</a></td>
              {% else %}
              <td>{{tipo}} - <a href="/clientes/apolices/{{tipo}}/editar/{{ap.pk}}">{{ap.apolice.nome}}</a></td>
              {%endif%}
              <td>R$ {{ap.premio|floatformat:2|default:"0,00"}}</td>
              <td>R$ {{ap.isbasica|floatformat:2|default:"0,00"}}</td>
              <td>R$ {{ap.premioconjuge|floatformat:2|default:"0,00"}}</td>
              <td>R$ {{ap.isbasicaconjuge|floatformat:2|default:"0,00"}}</td>
              <td>R$ {{ap.diagnostico|floatformat:2|default:"0,00"}}</td>
              <td>R$ {{ap.auxbaba|floatformat:2|default:"0,00"}}</td>
            </tr>
            {%endfor%}
            {%endif%}
            {%endfor%}
          </tbody>
        </table>
        <!-- Total -->
        <div class="d-flex flex-column">
          <h6>TOTAL : <span class="fw-bold fs-5">R$ {{premio|floatformat:2|default:"0,00"}}</span></h6>
          <h6>Soma das IS's básicas VIDA: <span class="fw-bold fs-5">R$ {{isTotal|floatformat:2|default:"0,00"}}</span></h6>
          <h6>Soma das IS's básicas VIDA (conj.): <span class="fw-bold fs-5">R$ {{isConj|floatformat:2|default:"0,00"}}</span></h6>
        </div>

        
        
      </div>
      {%endif%}
      {%if apolicesdiversas %}
      <div class="d-flex flex-column px-3 mt-3 border">
        <span class="fs-5">Resumo das Coberturas Diversas:</span>
        
        <table class="table table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>Apólice</th>
              <th>Prêmio</th>
              <th>Is Basica</th>
              
            </tr>
            
          </thead>
          <tbody>
            {% for tipo, info in apolicesdiversas.items %}
            {# só entra no loop interno se existir ao menos 1 apólice #}
            {% if info.tem %}
            {% for ap in info.apol %}
            <tr>
              <td>{{tipo}} - <a href="/clientes/apolices/{{tipo}}/editar/{{ap.pk}}">{{ap.apolice.empresa}}</a></td>
              <td>R$ {{ap.premio|floatformat:2|default:"0,00"}}</td>
              <td>R$ {{ap.isbasica|floatformat:2|default:"0,00"}}</td>
              
            </tr>
            {%endfor%}
            {%endif%}
            {%endfor%}
          </tbody>
        </table>
        
        <!-- Total -->
        <div class="d-flex align-items-center my-1">
          <strong class="me-2">TOTAL :</strong>
          <div class="border px-3 py-1">R$ {{premioTotalD|floatformat:2|default:"0,00"}}</div>
        </div>

        <!-- Somatórios -->
        <div>
          <strong>Soma das IS's :</strong> R$ {{isTotalD|floatformat:2|default:"0,00"}}
        </div>
        
      </div>
      {%endif%}
      {%if not apolicesdiversas and not apolices%}
      <h1 class="mt-5">Nenhuma apólice encontrada.</h1>
      {%endif%}
      
    </div>
    
  </div>
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="confirmDeleteLabel">Confirmação de Exclusão</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        Realmente deseja excluir este cliente?
      </div>
      <div class="modal-footer">
        <!-- Botão "Não" apenas fecha o modal -->
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
        <!-- Botão "Sim" redireciona -->
        <a href="{% url 'clientes_delete' cliente.pk %}" class="btn btn-danger">Sim</a>
      </div>
    </div>
  </div>
</div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>